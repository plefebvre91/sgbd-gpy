\documentclass{article}

\usepackage[french]{babel}
\usepackage[latin1]{inputenc}
\usepackage{amsmath,amssymb}
\usepackage{float}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage[normalem]{ulem}

%%%%%%%%%%%%%%%% Lengths %%%%%%%%%%%%%%%%
\setlength{\textwidth}{15.5cm}
\setlength{\evensidemargin}{0.5cm}
\setlength{\oddsidemargin}{0.5cm}

\begin{document}

\makeatletter
\def\clap#1{\hbox to 0pt{\hss #1\hss}}%
\def\ligne#1{%
\hbox to \hsize{%
\vbox{\centering #1}}}%
\def\haut#1#2#3{%
\hbox to \hsize{%
\rlap{\vtop{\raggedright #1}}%
\hss
\clap{\vtop{\centering #2}}%
\hss
\llap{\vtop{\raggedleft #3}}}}%
\def\bas#1#2#3{%
\hbox to \hsize{%
\rlap{\vbox{\raggedright #1}}%
\hss
\clap{\vbox{\centering #2}}%
\hss
\llap{\vbox{\raggedleft #3}}}}%
\def\maketitle{%
\thispagestyle{empty}\vbox to \vsize{%
\haut{}{\@blurb}{}
\vfill
\vspace{1cm}
\begin{flushright}
\usefont{OT1}{ptm}{m}{n}
\huge \@title
\end{flushright}
\par
\hrule height 4pt
\par
\begin{flushright}
\usefont{OT1}{phv}{m}{n}
\Large \@author
\par
\end{flushright}
\vspace{1cm}
\vfill
\vfill
\bas{}{Deuxième année, filière informatique.\\\@location, le \@date}{}
}%
\cleardoublepage
}
\def\date#1{\def\@date{#1}}
\def\author#1{\def\@author{#1}}
\def\title#1{\def\@title{#1}}
\def\location#1{\def\@location{#1}}
\def\blurb#1{\def\@blurb{#1}}
\date{\today}
\author{}
\title{}
\blurb{}
\makeatother
\title{Projet \emph{SGBD} : dotGame}
\author{Yvon Garbage, Pierre Lefebvre, Grégoire Pichon\\}
\location{Bordeaux}
\blurb{%
}%

\begin{figure}[!tp]
\centering
\includegraphics[width=0.6\textwidth]{enseirb-matmeca}
\label{fig:logo}
\end{figure}
\maketitle

\newenvironment{mld}
{\par\begin{minipage}{\linewidth}\begin{tabular}{rp{\linewidth}}}
{\end{tabular}\end{minipage}\par}
\newcommand{\relat}[1]{\textsc{#1}}
\newcommand{\attr}[1]{\emph{#1}}
\newcommand{\prim}[1]{\uline{#1}}
\newcommand{\foreign}[1]{\#\textsl{#1}}

\newpage
\tableofcontents
\newpage

\section*{Introduction}
\indent L'objectif de ce projet est de compléter le cours de SGBD dispensé à l'ENSEIRB-Matmeca par une mise en pratique. Réalisé par un trinôme, ce projet a pour objectif de se confronter au développement d'une base de donnéesrelationnelle. Ce document présente les différentes étapes relatives à ce projet, de la présentation du sujet à la réalisation d'une interface utilisateur. Il sera notamment explicité les problèmes relatifs à la modélisation et la réalisation des requêtes importantes.
\\

\indent Le choix pour l'environnement de travail a été des plus classiques: MySQL et PHP. Le site ainsi crée met en avant les différentes opérations réalisables sur la base de données.

\section{Présentation du sujet}
\indent La base de données à réaliser doit permettre de gérer une communauté de joueurs de jeux vidéos. Il est donc nécessaire de pouvoir gérer un ensemble de joueurs, un ensemble de jeux relatifs à certaines plateformes (type de console ou d'ordinateur) et à certaines catégories (Tir, Action \dots). Par ailleurs, un joueur doit pouvoir noter les différents jeux, par le biais de commentaires, et les autres joueurs doit pouvoir évaluer la pertinence du commentaire en question en donnant un avis positif ou négatif (pouce). Pour finir, un joueur doit pouvoir renseigner ses préférences: sa catégorie de jeu préférée et la plateforme sur laquelle il aime jouer.\\

\indent D'un point de vue implémentation, il est demandé de réaliser des requêtes basiques de consultation, de mise à jour, d'ajout ou encore de suppression. Par ailleurs, certaines requêtes plus avancées sont requises, elles seront explicités plus tard dans ce document. \\

\indent Le choix fait a été de réaliser l'ensemble des requêtes. Nous commencerons par étudier plus en détails les termes du sujet afin de fournir un modèle entité-association. Par la suite, nous présenterons le modèle relationnel avant de détailler l'implémentation avec MySQL et de présenter brièvement l'utilisation de notre interface graphique.
\newpage

\section{Modélisation}
\indent Cette partie entend préciser les étapes nécessaires à l'implémentation de la base de données. Le modèle conceptuel retenu sera présenté, ainsi que le modèle relationnel et les différentes étapes ayant permis cette mise en forme.

\subsection{Modèle conceptuel}
\indent Réaliser le modèle conceptuel demande de préciser quelques demandes du sujet, mais aussi de faire de choix. Nous verrons ces différents choix avant de présenter les entités et de détailler les opérations autorisées sur chaque entité.

\subsubsection{Contexte précis}
\begin{itemize}
\item Pour un joueur, le pseudonyme sera unique. Par ailleurs, la catégorie et la plateforme préférées devront obligatoirement être renseignées.
\item Un jeu étant disponible sur plusieurs plateformes, sa date de parution sera relative à une plateforme donnée.
\item Les joueurs doivent pouvoir noter les jeux, d'une note de 0 à 20 accompagnée d'un commentaire. Cependant, uun joueur ne pourra noter qu'une seule fois un jeu, et préciser alors la plateforme sur laquelle il y a joué.
\item Les joueurs peuvent indiquer s'ils trouvent un commentaire pertinent ou non. On s'assurera qu'un joueur ne peut pas évaluer un commentaire qu'il a lui même émis. De plus, un joueur ne pourra indiquer son avis qu'une fois par commentaire.
\item Les dates devront être cohérentes. Elles le seront toutes par rapport à la date actuelle. De plus, les dates des commentaires relatifs à une plateforme donnée pour un jeu devront être plus récentes que la date de sortie du jeu sur la plateforme en question. 
\end{itemize}

\subsubsection{Entités}
\indent A partir de l'ensemble des demandes initiales du sujet et des choix effectués, il est relativement aisé de décrire les différentes entités. Elles sont visibles dans le modèle conceptuel \ref{fig:mcd}. Les choix suivants ont été fait pour les associations: 
\begin{itemize}
\item Un joueur préfère une et une seule catégorie. Il en va de même pour la plateforme
\item Une catégorie peut n'être préférée par personne, mais correspond au minimum à un jeu. Idem pour une plateforme.
\item Un jeu peut poster plusieurs commentaires et en juger plusieurs.
\item Un pouce se réfère à un unique commentaire et provient d'un joueur précis.
\item Un commentaire concerne une plateforme et un jeu.
\item Un éditeur peut éditer plusieurs jeux, mais doit au minimum en éditer un.
\end{itemize}

\newpage
\begin{figure}[!h]
\begin{center}
\includegraphics[width=0.8\textwidth]{MCD.png}
\end{center}
\caption{Modèle conceptuel}
\label{fig:mcd}
\end{figure}
\newpage

\subsubsection{Opérations autorisées}
\indent Il doit être possible d'ajouter l'ensemble des entités dans la base de données. Cependant, les requêtes d'ajout, de même que les requêtes de mise à jour, doivent être en respect avec certains choix présentés antérieurement, notamment quand aux cardinalités des associations. \\

\indent Il est également possible de supprimer des données de la table. Il est imaginable de supprimer un éditeur, auquel cas l'ensemble des jeux édités par cet éditeur seront également supprimés. Dans la réalité, un joueur pourrait être supprimé de la base de donné (par exemple s'il est banni du forum). Dans ce cas, on supposera qu'il y a des raisons valables à son exclusion et que l'ensemble des commentaires qu'il a postés et des pouces qu'il a pu donné seront supprimés.

\subsection{Modèle relationnel}
\indent En considérant l'ensemble des associations, le passage au modèle relationnel ``naïf'' a seulement consisté a ajouter deux tables pour les deux ralations avec une cardinalité obligatoire de chaque côté. Par ailleurs, les relations de type obligatoire ou multiple d'un côté et unique de l'autre ont été mise dans les tables du côté unique. \\

\indent Plusieurs problèmes se sont alors posés. Une première idée a été de mettre en clé primaire le couple (idJeu, idPlateforme) pour la table commentaire. Cependant, ce choix n'a finalement pas été retenu pour plus de simplicité, et un idCommentaire a été ajouté. Par ailleurs, le choix initial de mettre un idJoueur a posé un problème de redondance avec le fait de définir un pseudo unique. Le pseudo du joueur a alors constitué sa clé primaire. Finalement, voici le modèle relationnel retenu: \\

\begin{mld}
  \relat{Joueur} & (\prim{pseudo}, \attr{nom}, \attr{prenom}, \attr{mail}, \foreign{idCategorie}, \foreign{idPlateforme})\\
  \relat{Pouce} & (\prim{idPouce}, \attr{valeur}, \foreign{pseudo}, \foreign{idCommentaire})\\
  \relat{Commentaire} & (\prim{idCommentaire}, \attr{note}, \attr{commentaire}, \attr{date}, \foreign{pseudo}, \foreign{idJeu}, \foreign{idPlateforme})\\
  \relat{Categorie} & (\prim{idCategorie}, \attr{nomCategorie})\\
  \relat{Jeu} & (\prim{idJeu}, \attr{nomJeu}, \foreign{idEditeur})\\
  \relat{Plateforme} & (\prim{idPlateforme}, \attr{nomPlateforme})\\
  \relat{Editeur} & (\prim{idEditeur}, \attr{nomEditeur})\\
  \relat{Appartient} & (\prim{\foreign{idCategorie}, \foreign{idJeu}})\\
  \relat{Est disponible} & (\prim{\foreign{idPlateforme}, \foreign{idJeu}}, \attr{dateSortie})\\ \\
\end{mld}

\indent A noter que le modèle ci-dessus n'est pas en troisième forme normale. En effet, il est possible de connaître le nom et le prénom d'un joueur à partir de son adresse mail, qui n'est pas une clé primaire. Pour éviter ce problème, il aurait fallut créer une table informations en association avec la table joueur et contenant son nom et son prénom. Cependant, après discussion, cette solution n'a pas été retenue pour plus de clarté quand à l'entité joueur.

\newpage
\section{Zoom sur les requêtes importantes}
\indent Plusieurs requêtes étaient explicitement demandées dans le sujet. Nous commencerons par détailler certaines requêtes de consultation avant de voir celles de statistiques puis étudier le cas de la mise à jour.

\subsection{Requêtes de consultation}
\subsubsection{Ensemble des jeux critiqués sur une plateforme donnée}
  %% $query = " SELECT res.nomJeu, categorie.nomCategorie FROM categorie INNER JOIN
  %%       (SELECT jeu.*, appartient.idCategorie FROM jeu LEFT OUTER JOIN appartient
  %%       	       ON jeu.idJeu = appartient.idJeu
  %%       	       WHERE jeu.idJeu IN
  %%       	       	     (SELECT jeu.idJeu FROM jeu INNER JOIN estDisponible ON jeu.idJeu = estDisponible.idJeu
  %%                    	     WHERE estDisponible.idPlateforme IN
  %%            	             	   (SELECT plateforme.idPlateforme FROM plateforme INNER JOIN estDisponible
  %%              	       			       ON plateforme.idPlateforme = estDisponible.idPlateforme
  %%       				       WHERE plateforme.nomPlateforme = '$platform')
  %%                 	     AND jeu.idJeu IN
  %%                            	   (SELECT jeu.idJeu FROM commentaire INNER JOIN jeu
  %%            	     	       	    	  ON jeu.idJeu = commentaire.idJeu))) as res
  %%       ON categorie.idCategorie = res.idCategorie
  %%        ORDER BY categorie.nomCategorie ASC";

\subsubsection{Liste des commentaires pour une catégorie et une plateforme données}
\indent Chaque joueur est obligé d'indiquer une catégorie préférée ainsi qu'une plateforme préférée. Il peut donc être intéressant pour lui de savoir rapidement ce que pensent les autres jours des jeux existants avec ces deux contraintes. \\

\indent On commence par faire une jointure interne entre les tables commentaire et jeu avec la contrainte d'avoir le même idJeu. On ajoute la contrainte que cet idJeu soit également dans une sélection de jeux correspondant à la catégorie et la plateforme préférées du joueur. Pour cela, on fait une jointure interne avec la table appartient pour la catégorie, et pour la plateforme on vérifie la cohérence entre la table commentaire et la table joueur, qui contiennent toutes idPlateforme.

\subsubsection{Liste des joueurs ayant apprécié un commentaire}
\indent Il suffit ici de faire une double jointure interne entre les tables joueur, pouce et commentaire. Les pouce positifs pour un commentaire donné sont retenus et on peut alors accéder au joueur ayant émis cet avis.

\subsection{Requêtes de statistiques}
\subsubsection{Classement des joueurs selon leur nombre de commentaires}
\indent Le nombre de commentaires par joueur est disponible avec une jointure interne entre les tables joueur et commentaire. En utilisant le schméma ``count (*) group by'', on peut compter ce nombre de commentaire et les classer avec un ``order by count(*) desc''.

\subsubsection{n commentaires les plus récents}
\indent Pour recenser les $n$ plus récents commentaires, on peut se baser sur leur date d'émission. Avec MySQL il est possible de limiter en nombre d'éléments un tri avec un ``order by * desc limit n''.

\subsubsection{Commentaire laissant le moins indifférent}
\indent Pour cette requête on renverra le ou les commentaire(s) laissant le moins indifférent. On commence par rechercher dans la table pouce le nombre maximal d'avis sur un commentaire. Il est ensuite possible de récupérer l'ensemble des identifiants de commentaire, dans la table pouce, ayant ce nombre maximal d'avis. Pour finir, avec une jointure interne avec la table commentaire, l'accès aux commentaires est possible.

\subsubsection{Classement des commentaires selon leur indice de confiance}
\indent Chaque commentaire possède un indice de confiance. Soit $c$ le nombre d'appréciations positives d'un commentaire et $d$ son nombre d'appréciations négatives. L'indice de confiance correspond alors au rapport:
\begin{equation}
  \frac{1+c}{1+d}
\end{equation}
  %% $query = "SELECT idCommentaire, note, commentaire, dateCommentaire, pseudo, idJeu, idPlateforme, (1 + res.c)/(1 + res.d) AS indiceConfiance FROM (
  %%      SELECT commentaire.*, SUM(IF(pouce.valeur = '+', 1, 0)) AS c, SUM(IF(pouce.valeur = '-', 1, 0)) AS d
  %%      FROM commentaire LEFT OUTER JOIN pouce ON commentaire.idCommentaire = pouce.idCommentaire
  %%      GROUP BY commentaire.idCommentaire) AS res
  %%      ORDER BY (1 + res.c)/(1 + res.d) DESC, res.dateCommentaire DESC";


\subsection{Requêtes de mise à jour}


\newpage
\section{Interface: réalisation et utilisation}
\subsection{Présentation générale de l'interface et de son environnement}
\subsection{Problèmes - limites aux contraintes initialement fixées}

\newpage
\section*{Conclusion}
\indent Ce projet a permis de mettre en oeuvre différentes techniques vues dans le module SGBD. Il a notamment permis de comprendre les différentes étapes nécessaires à la bonne création d'une base de données. Si le modèle conceptuel peut initialement sembler suffisant, la mise sous forme normale permet de déceler certains problèmes relatifs à l'intégrité de la base. \\

\indent Par ailleurs, ce projet permet de mettre en avant les difficultés que pose la modélisation d'une base de données. Si certaines données ont clairement leur place quel que soit la modélisation choisie, d'autres sont sujettes à discussion. Il s'agit alors de bien définir les contraintes pour permettre une des principales attentes d'une base de donnée: la cohérence.

\end{document}
